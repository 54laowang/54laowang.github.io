<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>老王博客</title>
  <icon>https://www.gravatar.com/avatar/55eb189027fadb58a159ea8bbd290a9a</icon>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://54laowang.github.io/"/>
  <updated>2018-08-23T11:56:16.325Z</updated>
  <id>http://54laowang.github.io/</id>
  
  <author>
    <name>laowang</name>
    <email>271873770@qq.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Print Serial</title>
    <link href="http://54laowang.github.io/2018/08/23/print-serial/"/>
    <id>http://54laowang.github.io/2018/08/23/print-serial/</id>
    <published>2018-08-23T11:33:11.000Z</published>
    <updated>2018-08-23T11:56:16.325Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Ubuntu下调试串口热敏打印机"><a href="#Ubuntu下调试串口热敏打印机" class="headerlink" title="Ubuntu下调试串口热敏打印机"></a>Ubuntu下调试串口热敏打印机</h1><p>系统环境：Ubuntu16.04  ，我们调试的是一台普通串口打印机，由于Ubuntu下面驱动支持不友好，所以我们选择先测试下串口通信是否正常。<br>首先我们可以使用<strong>stty</strong>查看串口参数<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">stty -F /dev/ttyS0 -a</span><br></pre></td></tr></table></figure></p><p>我们连接测试的是串口1，所以使用该命令查看串口1当前的参数，包括波特率、数据位等。由于我们打印机默认波特率为19200，所以如果波特率不符的话，我们还可以通过<strong>stty</strong>修改串口参数<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">stty -F /dev/ttyS0 ispeed 19200</span><br></pre></td></tr></table></figure></p><p>查看串口是否可用，我们也可以直接对串口发送数据，比如<strong>COM1</strong><br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo ceshi123 &gt;/dev/ttyS0</span><br></pre></td></tr></table></figure></p><p>查看串口名称使用<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ls -l | /dev/ttyS*</span><br></pre></td></tr></table></figure></p><p>一般情况下串口名称全部在dev下面<br>查看串口设备命令可使用<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dmesg | grep ttyS*</span><br></pre></td></tr></table></figure></p><p>我们直接对串口发送中文后，打印机输出乱码，一般是字符编码问题<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo &quot;测试&quot; | iconv -f UTF-8 -t GB2312 &gt; /dev/usb/ttyS0</span><br></pre></td></tr></table></figure></p><p>使用iconv函数转换字符编码后，测试打印机正常输出中文。</p><p>现在打印机可以正常输出内容了，接下来我们测试其它功能，现在打印机基本都兼容爱普生的Escpos指令，为了更简单迅速做测试，我们此处使用Python来写一个简单的DEMO，在写之前，我们需要先配置下相应的开发环境。</p><p>Ubuntu系统默认内置Python2和Python3，此处我们使用Python3</p><p>打开终端安装<strong>pip3</strong>,然后通过<strong>pip3</strong>安装<strong>python-escpos</strong></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sudo apt-get install python3-pip</span><br><span class="line">pip3 install python-escpos</span><br></pre></td></tr></table></figure><p>确认安装完成后我们就可以做一个简单的打印DEMO了<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#-*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> escpos <span class="keyword">import</span> *</span><br><span class="line">p = printer.Serial(<span class="string">"/dev/ttyS0"</span>)</span><br><span class="line">p.text(<span class="string">"Hello World\n\n\n"</span>)</span><br><span class="line">p.qr(<span class="string">"http://www.winpos.com.cn"</span>)</span><br><span class="line">p.cut( )</span><br></pre></td></tr></table></figure></p><p>保存文件为<strong>printdemo.py</strong><br>执行<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python3 printdemo.py</span><br></pre></td></tr></table></figure></p><p>此时打印机就会打出一张带二维码的小票，并切纸，测试OK。</p><p>现在这个demo还有点小问题，因为不能输出中文，所以后续还需要再完善。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Ubuntu下调试串口热敏打印机&quot;&gt;&lt;a href=&quot;#Ubuntu下调试串口热敏打印机&quot; class=&quot;headerlink&quot; title=&quot;Ubuntu下调试串口热敏打印机&quot;&gt;&lt;/a&gt;Ubuntu下调试串口热敏打印机&lt;/h1&gt;&lt;p&gt;系统环境：Ubuntu16.
      
    
    </summary>
    
    
  </entry>
  
</feed>
